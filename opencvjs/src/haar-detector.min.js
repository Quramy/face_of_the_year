/**
*
* HAAR.js Feature Detection Library based on Viola-Jones Haar Detection algorithm
* port of jViolaJones  for Java (http://code.google.com/p/jviolajones/) to JavaScript and Node
*
* https://github.com/foo123/HAAR.js
* @version: 0.4.8
*
* Supports parallel "map-reduce" computation both in browser and node using parallel.js library 
* https://github.com/adambom/parallel.js (included)
*
**/
/**
 *
 * HAAR.js Feature Detection Library based on Viola-Jones Haar Detection algorithm
 * port of jViolaJones  for Java (http://code.google.com/p/jviolajones/) to JavaScript and Node
 *
 * https://github.com/foo123/HAAR.js
 * @version: 0.4.8
 *
 * Supports parallel "map-reduce" computation both in browser and node using parallel.js library 
 * https://github.com/adambom/parallel.js (included)
 *
 **/
! function(e, n, t) {
    "use strict";
    var i, a = "object" == typeof module && module.exports,
        l = "function" == typeof define && define.amd;
    a ? module.exports = (module.$deps = module.$deps || {})[n] = module.$deps[n] || t.call(e, {
        NODE: module
    }) || 1 : l && "function" == typeof require && "function" == typeof require.specified && require.specified(n) ? define(n, ["require", "exports", "module"], function(n, i, a) {
        return t.call(e, {
            AMD: a
        })
    }) : n in e || (e[n] = i = t.call(e, {}) || 1) && l && define(n, [], function() {
        return i
    })
}(this, "HAAR", function(e) {
    return ! function(e, n) {
        "use strict";

        function t(e, n, t) {
            var i, a, l, r, o, h, u, c = e.length,
                s = n * t,
                d = new y(s),
                g = new f(s),
                w = new f(s),
                v = new f(s);
            for (r = 0, l = 0, i = a = 0; n > r;) u = 4899 * e[l] + 9617 * e[l + 1] + 1868 * e[l + 2] + 8192 >>> 14, u &= 255, i += u, a += u * u, d[r] = u, g[r] = i, w[r] = a, v[r] = u, r++, l += 4;
            for (o = 0, h = 1, r = n, l = n << 2, i = a = 0; c > l;) u = 4899 * e[l] + 9617 * e[l + 1] + 1868 * e[l + 2] + 8192 >>> 14, u &= 255, i += u, a += u * u, d[r] = u, g[r] = g[r - n] + i, w[r] = w[r - n] + a, v[r] = v[r + 1 - n] + (u + d[r - n]) + (h > 1 ? v[r - n - n] : 0) + (o > 0 ? v[r - 1 - n] : 0), o++, r++, l += 4, o >= n && (o = 0, h++, i = a = 0);
            return {
                gray: d,
                integral: g,
                squares: w,
                tilted: v
            }
        }

        function i(e, n, t) {
            var i, a, l, r, o, h, u, c, s, d, g, v = e.length,
                x = new y(v),
                m = new f(v);
            for (i = 0; n > i; i++) x[i] = 0, x[i + n] = 0, x[i + v - n] = 0, x[i + v - n - n] = 0, m[i] = 0, m[i + v - n] = 0;
            for (a = 0, l = 0; t > a; a++, l += n) x[0 + l] = 0, x[1 + l] = 0, x[n - 1 + l] = 0, x[n - 2 + l] = 0, m[0 + l] = 0, m[n - 1 + l] = 0;
            for (i = 2; n - 2 > i; i++)
                for (r = 0, a = 2, l = n << 1; t - 2 > a; a++, l += n) u = i + l, c = u + n, s = c + n, d = u - n, g = d - n, r = 0 + (e[g - 2] << 1) + (e[d - 2] << 2) + (e[u - 2] << 2) + e[u - 2] + (e[c - 2] << 2) + (e[s - 2] << 1) + (e[g - 1] << 2) + (e[d - 1] << 3) + e[d - 1] + (e[u - 1] << 4) - (e[u - 1] << 2) + (e[c - 1] << 3) + e[c - 1] + (e[s - 1] << 2) + (e[g] << 2) + e[g] + (e[d] << 4) - (e[d] << 2) + (e[u] << 4) - e[u] + (e[c] << 4) - (e[c] << 2) + (e[s] << 2) + e[s] + (e[g + 1] << 2) + (e[d + 1] << 3) + e[d + 1] + (e[u + 1] << 4) - (e[u + 1] << 2) + (e[c + 1] << 3) + e[c + 1] + (e[s + 1] << 2) + (e[g + 2] << 1) + (e[d + 2] << 2) + (e[u + 2] << 2) + e[u + 2] + (e[c + 2] << 2) + (e[s + 2] << 1), x[u] = ((103 * r + 8192 & 4294967295) >>> 14 & 255) >>> 0;
            for (i = 1; n - 1 > i; i++)
                for (a = 1, l = n; t - 1 > a; a++, l += n) u = l + i, c = u + n, d = u - n, o = 0 - x[d - 1] + x[d + 1] - x[u - 1] - x[u - 1] + x[u + 1] + x[u + 1] - x[c - 1] + x[c + 1], h = 0 + x[d - 1] + x[d] + x[d] + x[d + 1] - x[c - 1] - x[c] - x[c] - x[c + 1], m[u] = w(o) + w(h);
            for (i = 0, r = 0; n > i;) r += m[i], m[i] = r, i++;
            for (i = n, l = 0, r = 0; v > i;) r += m[i], m[i] = m[i - n] + r, i++, l++, l >= n && (l = 0, r = 0);
            return m
        }

        function a(e, n, t) {
            var i, a, r, o, h, u, c, d = e.length,
                g = new Array(d),
                f = [],
                y = 0,
                w = !1;
            for (r = 0; d > r; r++) g[r] = 0;
            for (r = 0; d > r; r++) {
                for (w = !1, o = 0; r > o; o++) e[o].almostEqual(e[r]) && (w = !0, g[r] = g[o]);
                w || (g[r] = y, y++)
            }
            for (i = new Array(y), a = new Array(y), r = 0; y > r; r++) i[r] = 0, a[r] = new s;
            for (r = 0; d > r; r++) c = g[r], i[c]++, a[c].add(e[r]);
            for (r = 0; y > r; r++) h = i[r], h >= n && (u = 1 / (h + h), c = new s(u * (2 * a[r].x + h), u * (2 * a[r].y + h), u * (2 * a[r].width + h), u * (2 * a[r].height + h)), f.push(c));
            for (1 != t && (t = 1 / t), d = f.length, r = 0; d > r; r++)
                for (o = r + 1; d > o; o++) !f[r].isInside && f[r].inside(f[o]) ? f[r].isInside = !0 : !f[o].isInside && f[o].inside(f[r]) && (f[o].isInside = !0);
            for (r = d; --r >= 0;) f[r].isInside ? f.splice(r, 1) : (1 != t && f[r].scale(t), f[r].round().computeArea());
            return f.sort(l)
        }

        function l(e, n) {
            return e.area - n.area
        }

        function r(e, n) {
            return e.index - n.index
        }

        function o(e) {
            return e[1].length && (e[0] = e[0].concat(e[1]).sort(r)), e[0]
        }

        function h(e) {
            var n, t, i, a, l, r, o, h, u, c, s, d, g, f, y, w, v, x, m, p, S, I, C, q, R, A, H, b, _, D, P, T, j, x, M, L, W, z, E, k, F, O, $, N, U, V, B, G, J, K, Q, X, Y, Z = Z || Math.sqrt,
                en = [],
                nn = e.haardata,
                tn = nn.stages,
                an = e.scaledSelection,
                ln = an.width,
                rn = an.height,
                on = ln * rn,
                hn = on - 1,
                un = nn.size1,
                cn = nn.size2,
                sn = an.x,
                dn = an.y,
                gn = tn.length,
                fn = e.cannyLow,
                yn = e.cannyHigh,
                wn = e.canny,
                vn = e.integral,
                xn = e.squares,
                mn = e.tilted,
                pn = e.scale,
                Sn = e.increment,
                In = e.i || 0,
                Cn = e.doCannyPruning;
            for (m = 0, p = ln - 1, S = 0, I = on - ln, i = ~~(pn * un), n = ~~(i * Sn), a = ~~(pn * cn), t = ~~(a * Sn), u = a * ln, c = t * ln, l = dn * c, y = ln - i, w = rn - a, C = i * a, q = 1 / C, o = dn, h = l; w > o; o += t, h += c)
                for (r = sn; y > r; r += n)
                    if (s = r - 1 + h - ln, d = s + i, g = s + u, f = g + i, s = 0 > s ? 0 : s > hn ? hn : s, d = 0 > d ? 0 : d > hn ? hn : d, g = 0 > g ? 0 : g > hn ? hn : g, f = 0 > f ? 0 : f > hn ? hn : f, !(Cn && (b = q * (wn[f] - wn[g] - wn[d] + wn[s]), fn > b || b > yn))) {
                        for (R = q * (vn[f] - vn[g] - vn[d] + vn[s]), A = q * (xn[f] - xn[g] - xn[d] + xn[s]), H = A - R * R, H = H > 1 ? Z(H) : 1, _ = !0, v = 0; gn > v; v++) {
                            for (D = tn[v], P = D.thres, T = D.trees, j = T.length, Y = 0, x = 0; j > x; x++)
                                for (W = T[x].feats, M = 0;;) {
                                    if (z = W[M], E = z.rects, k = E.length, F = z.thres, O = 0, z.tilt)
                                        for ($ = 0; k > $; $++) N = E[$], U = r + ~~(pn * N[0]), V = (o - 1 + ~~(pn * N[1])) * ln, B = r + ~~(pn * (N[0] + N[2])), G = (o - 1 + ~~(pn * (N[1] + N[2]))) * ln, J = r + ~~(pn * (N[0] - N[3])), K = (o - 1 + ~~(pn * (N[1] + N[3]))) * ln, Q = r + ~~(pn * (N[0] + N[2] - N[3])), X = (o - 1 + ~~(pn * (N[1] + N[2] + N[3]))) * ln, U = m > U ? m : U > p ? p : U, B = m > B ? m : B > p ? p : B, J = m > J ? m : J > p ? p : J, Q = m > Q ? m : Q > p ? p : Q, V = S > V ? S : V > I ? I : V, G = S > G ? S : G > I ? I : G, K = S > K ? S : K > I ? I : K, X = S > X ? S : X > I ? I : X, O += N[4] * (mn[Q + X] - mn[J + K] - mn[B + G] + mn[U + V]);
                                    else
                                        for ($ = 0; k > $; $++) N = E[$], U = r - 1 + ~~(pn * N[0]), B = r - 1 + ~~(pn * (N[0] + N[2])), V = ln * (o - 1 + ~~(pn * N[1])), G = ln * (o - 1 + ~~(pn * (N[1] + N[3]))), U = m > U ? m : U > p ? p : U, B = m > B ? m : B > p ? p : B, V = S > V ? S : V > I ? I : V, G = S > G ? S : G > I ? I : G, O += N[4] * (vn[B + G] - vn[U + G] - vn[B + V] + vn[U + V]);
                                    if (L = F * H > O * q ? 0 : 1) {
                                        if (z.has_r) {
                                            Y += z.r_val;
                                            break
                                        }
                                        M = z.r_node
                                    } else {
                                        if (z.has_l) {
                                            Y += z.l_val;
                                            break
                                        }
                                        M = z.l_node
                                    }
                                }
                            if (_ = Y > P ? !0 : !1, !_) break
                        }
                        _ && en.push({
                            index: In,
                            x: r,
                            y: o,
                            width: i,
                            height: a
                        })
                    }
            return en
        }

        function u(e, n) {
            for (var t = 0, i = n.length; i > t; t++) n[t] = new s(n[t]);
            e.objects = a(n, e.min_neighbors, e.Ratio, e.Selection), e.Ready = !0, e.onComplete && e.onComplete.call(e)
        }
        var c, s, d = e.HAAR = {
                VERSION: "0.4.8"
            },
            g = "prototype",
            f = "undefined" != typeof Float32Array ? Float32Array : Array,
            y = "undefined" != typeof Uint8Array ? Uint8Array : Array,
            w = Math.abs,
            v = Math.max,
            x = Math.min,
            m = (Math.floor, Math.round),
            p = (Math.sqrt, Array[g].slice);
        c = d.Detector = function(e, n) {
            var t = this;
            t.haardata = e || null, t.Ready = !1, t.doCannyPruning = !1, t.Canvas = null, t.Selection = null, t.scaledSelection = null, t.objects = null, t.TimeInterval = null, t.DetectInterval = 30, t.Ratio = .5, t.cannyLow = 20, t.cannyHigh = 100, t.Parallel = n || null, t.onComplete = null
        }, c[g] = {
            constructor: c,
            haardata: null,
            Canvas: null,
            objects: null,
            Selection: null,
            scaledSelection: null,
            Ratio: .5,
            origWidth: 0,
            origHeight: 0,
            width: 0,
            height: 0,
            DetectInterval: 30,
            TimeInterval: null,
            doCannyPruning: !1,
            cannyLow: 20,
            cannyHigh: 100,
            canny: null,
            integral: null,
            squares: null,
            tilted: null,
            Parallel: null,
            Ready: !1,
            onComplete: null,
            dispose: function() {
                var e = this;
                return e.DetectInterval && clearTimeout(e.DetectInterval), e.DetectInterval = null, e.TimeInterval = null, e.haardata = null, e.Canvas = null, e.objects = null, e.Selection = null, e.scaledSelection = null, e.Ratio = null, e.origWidth = null, e.origHeight = null, e.width = null, e.height = null, e.doCannyPruning = null, e.cannyLow = null, e.cannyHigh = null, e.canny = null, e.integral = null, e.squares = null, e.tilted = null, e.Parallel = null, e.Ready = null, e.onComplete = null, e
            },
            clearCache: function() {
                var e = this;
                return e.haardata = null, e.canny = null, e.integral = null, e.squares = null, e.tilted = null, e.Selection = null, e.scaledSelection = null, e
            },
            cascade: function(e) {
                return this.haardata = e || null, this
            },
            parallel: function(e) {
                return this.Parallel = e || null, this
            },
            image: function(e, a, l) {
                var r = this;
                if (e) {
                    var o, h, u, c, s, d, g, f, y, w = e instanceof HTMLVideoElement;
                    r.Canvas || (r.Canvas = l || document.createElement("canvas")), y = r.Canvas, f = r.Ratio = n === a ? .5 : a, r.Ready = !1, c = r.origWidth = w ? e.videoWidth : e.width, s = r.origHeight = w ? e.videoHeight : e.height, d = r.width = y.width = m(f * c), g = r.height = y.height = m(f * s), o = y.getContext("2d"), o.drawImage(e, 0, 0, c, s, 0, 0, d, g), h = o.getImageData(0, 0, d, g), u = t(h.data, h.width, h.height), r.integral = u.integral, r.squares = u.squares, r.tilted = u.tilted, r.canny = i(u.gray, d, g), u.gray = null, u.integral = null, u.squares = null, u.tilted = null, u = null
                }
                return r
            },
            interval: function(e) {
                return e > 0 && (this.DetectInterval = e), this
            },
            cannyThreshold: function(e) {
                return e && n !== e.low && (this.cannyLow = e.low), e && n !== e.high && (this.cannyHigh = e.high), this
            },
            select: function() {
                var e = p.call(arguments),
                    n = e.length;
                return this.Selection = 1 == n && "auto" == e[0] || !n ? null : s[g].data.apply(new s, e), this
            },
            complete: function(e) {
                return this.onComplete = e || null, this
            },
            detect: function(e, t, i, a, l) {
                var c, d, g, f, y = this,
                    w = y.haardata,
                    v = w.size1,
                    m = w.size2,
                    p = y.width,
                    S = y.height,
                    I = y.origWidth,
                    C = y.origHeight,
                    q = y.integral,
                    R = y.squares,
                    A = y.tilted,
                    H = y.canny,
                    b = y.cannyLow,
                    _ = y.cannyHigh;
                y.Selection || (y.Selection = new s(0, 0, I, C)), c = y.Selection, c.x = "auto" == c.x ? 0 : c.x, c.y = "auto" == c.y ? 0 : c.y, c.width = "auto" == c.width ? I : c.width, c.height = "auto" == c.height ? C : c.height, d = y.scaledSelection = c.clone().scale(y.Ratio).round(), e = n === e ? 1 : e, t = n === t ? 1.25 : t, i = n === i ? .5 : i, a = n === a ? 1 : a, l = y.doCannyPruning = n === l ? !0 : l, g = y.maxScale = x(p / v, S / m), f = y.scale = e, y.min_neighbors = a, y.scale_inc = t, y.increment = i, y.Ready = !1;
                var D = y.Parallel;
                if (D && D.isSupported()) {
                    var P, T = [],
                        j = 0;
                    for (P = e; g >= P; P *= t) T.push({
                        haardata: w,
                        width: p,
                        height: S,
                        scaledSelection: {
                            x: d.x,
                            y: d.y,
                            width: d.width,
                            height: d.height
                        },
                        integral: q,
                        squares: R,
                        tilted: A,
                        doCannyPruning: l,
                        canny: l ? H : null,
                        cannyLow: b,
                        cannyHigh: _,
                        maxScale: g,
                        min_neighbors: a,
                        scale_inc: t,
                        increment: i,
                        scale: P,
                        i: j++
                    });
                    new D(T, {
                        synchronous: !1
                    }).require(r, h, o).map(h).reduce(o).then(function(e) {
                        u(y, e)
                    })
                } else {
                    var M = [],
                        L = function() {
                            y.scale <= y.maxScale ? (M = M.concat(h(y)), y.scale *= y.scale_inc, y.TimeInterval = setTimeout(L, y.DetectInterval)) : (clearTimeout(y.TimeInterval), u(y, M))
                        };
                    y.TimeInterval = setTimeout(L, y.DetectInterval)
                }
                return y
            },
            detectSync: function(e, n, t, i, l) {
                var r, o, u = this,
                    c = u.haardata.size1,
                    d = u.haardata.size2;
                u.Selection || (u.Selection = new s(0, 0, u.origWidth, u.origHeight)), u.Selection.x = "auto" == u.Selection.x ? 0 : u.Selection.x, u.Selection.y = "auto" == u.Selection.y ? 0 : u.Selection.y, u.Selection.width = "auto" == u.Selection.width ? u.origWidth : u.Selection.width, u.Selection.height = "auto" == u.Selection.height ? u.origHeight : u.Selection.height, u.scaledSelection = u.Selection.clone().scale(u.Ratio).round(), e = "undefined" == typeof e ? 1 : e, n = "undefined" == typeof n ? 1.25 : n, t = "undefined" == typeof t ? .5 : t, i = "undefined" == typeof i ? 1 : i, u.doCannyPruning = "undefined" == typeof l ? !0 : l, o = u.maxScale = x(u.width / c, u.height / d), r = u.scale = e, u.min_neighbors = i, u.scale_inc = n, u.increment = t, u.Ready = !1;
                for (var g = []; o >= r;) g = g.concat(h(u)), u.scale = r *= n;
                for (var f = 0, y = g.length; y > f; f++) g[f] = new s(g[f]);
                return u.objects = a(g, u.min_neighbors, u.Ratio, u.Selection), u.Ready = !0, u.objects
            }
        }, c[g].selection = c[g].select, s = d.Feature = function(e, n, t, i, a) {
            this.data(e, n, t, i, a)
        }, s[g] = {
            constructor: s,
            index: 0,
            x: 0,
            y: 0,
            width: 0,
            height: 0,
            area: 0,
            isInside: !1,
            data: function(e, n, t, i, a) {
                var l = this;
                return e && e instanceof s ? l.copy(e) : e && e instanceof Object ? (l.x = e.x || 0, l.y = e.y || 0, l.width = e.width || 0, l.height = e.height || 0, l.index = e.index || 0, l.area = e.area || 0, l.isInside = e.isInside || !1) : (l.x = e || 0, l.y = n || 0, l.width = t || 0, l.height = i || 0, l.index = a || 0, l.area = 0, l.isInside = !1), l
            },
            add: function(e) {
                var n = this;
                return n.x += e.x, n.y += e.y, n.width += e.width, n.height += e.height, n
            },
            scale: function(e) {
                var n = this;
                return n.x *= e, n.y *= e, n.width *= e, n.height *= e, n
            },
            round: function() {
                var e = this;
                return e.x = ~~(e.x + .5), e.y = ~~(e.y + .5), e.width = ~~(e.width + .5), e.height = ~~(e.height + .5), e
            },
            computeArea: function() {
                var e = this;
                return e.area = e.width * e.height, e.area
            },
            inside: function(e) {
                var n = this;
                return !!(n.x >= e.x && n.y >= e.y && n.x + n.width <= e.x + e.width && n.y + n.height <= e.y + e.height)
            },
            contains: function(e) {
                return e.inside(this)
            },
            equal: function(e) {
                var n = this;
                return !(e.x !== n.x || e.y !== n.y || e.width !== n.width || e.height !== n.height)
            },
            almostEqual: function(e) {
                var n = this,
                    t = .2 * v(e.width, n.width),
                    i = .2 * v(e.height, n.height);
                return !!(w(n.x - e.x) <= t && w(n.y - e.y) <= i && w(n.width - e.width) <= t && w(n.height - e.height) <= i)
            },
            clone: function() {
                var e = this,
                    n = new s;
                return n.x = e.x, n.y = e.y, n.width = e.width, n.height = e.height, n.index = e.index, n.area = e.area, n.isInside = e.isInside, n
            },
            copy: function(e) {
                var n = this;
                return e && e instanceof s && (n.x = e.x, n.y = e.y, n.width = e.width, n.height = e.height, n.index = e.index, n.area = e.area, n.isInside = e.isInside), n
            },
            toString: function() {
                return ["[ x:", this.x, "y:", this.y, "width:", this.width, "height:", this.height, "]"].join(" ")
            }
        }
    }(e), e.HAAR
});
// !function(e,n,t){"use strict";var i,a="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;a?module.exports=(module.$deps=module.$deps||{})[n]=module.$deps[n]||t.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(n,i,a){return t.call(e,{AMD:a})}):n in e||(e[n]=i=t.call(e,{})||1)&&l&&define(n,[],function(){return i})}(this,"HAAR",function(e){return!function(e,n){"use strict";function t(e,n,t){var i,a,l,r,o,h,u,c=e.length,s=n*t,d=new y(s),g=new f(s),w=new f(s),v=new f(s);for(r=0,l=0,i=a=0;n>r;)u=4899*e[l]+9617*e[l+1]+1868*e[l+2]+8192>>>14,u&=255,i+=u,a+=u*u,d[r]=u,g[r]=i,w[r]=a,v[r]=u,r++,l+=4;for(o=0,h=1,r=n,l=n<<2,i=a=0;c>l;)u=4899*e[l]+9617*e[l+1]+1868*e[l+2]+8192>>>14,u&=255,i+=u,a+=u*u,d[r]=u,g[r]=g[r-n]+i,w[r]=w[r-n]+a,v[r]=v[r+1-n]+(u+d[r-n])+(h>1?v[r-n-n]:0)+(o>0?v[r-1-n]:0),o++,r++,l+=4,o>=n&&(o=0,h++,i=a=0);return{gray:d,integral:g,squares:w,tilted:v}}function i(e,n,t){var i,a,l,r,o,h,u,c,s,d,g,v=e.length,x=new y(v),m=new f(v);for(i=0;n>i;i++)x[i]=0,x[i+n]=0,x[i+v-n]=0,x[i+v-n-n]=0,m[i]=0,m[i+v-n]=0;for(a=0,l=0;t>a;a++,l+=n)x[0+l]=0,x[1+l]=0,x[n-1+l]=0,x[n-2+l]=0,m[0+l]=0,m[n-1+l]=0;for(i=2;n-2>i;i++)for(r=0,a=2,l=n<<1;t-2>a;a++,l+=n)u=i+l,c=u+n,s=c+n,d=u-n,g=d-n,r=0+(e[g-2]<<1)+(e[d-2]<<2)+(e[u-2]<<2)+e[u-2]+(e[c-2]<<2)+(e[s-2]<<1)+(e[g-1]<<2)+(e[d-1]<<3)+e[d-1]+(e[u-1]<<4)-(e[u-1]<<2)+(e[c-1]<<3)+e[c-1]+(e[s-1]<<2)+(e[g]<<2)+e[g]+(e[d]<<4)-(e[d]<<2)+(e[u]<<4)-e[u]+(e[c]<<4)-(e[c]<<2)+(e[s]<<2)+e[s]+(e[g+1]<<2)+(e[d+1]<<3)+e[d+1]+(e[u+1]<<4)-(e[u+1]<<2)+(e[c+1]<<3)+e[c+1]+(e[s+1]<<2)+(e[g+2]<<1)+(e[d+2]<<2)+(e[u+2]<<2)+e[u+2]+(e[c+2]<<2)+(e[s+2]<<1),x[u]=((103*r+8192&4294967295)>>>14&255)>>>0;for(i=1;n-1>i;i++)for(a=1,l=n;t-1>a;a++,l+=n)u=l+i,c=u+n,d=u-n,o=0-x[d-1]+x[d+1]-x[u-1]-x[u-1]+x[u+1]+x[u+1]-x[c-1]+x[c+1],h=0+x[d-1]+x[d]+x[d]+x[d+1]-x[c-1]-x[c]-x[c]-x[c+1],m[u]=w(o)+w(h);for(i=0,r=0;n>i;)r+=m[i],m[i]=r,i++;for(i=n,l=0,r=0;v>i;)r+=m[i],m[i]=m[i-n]+r,i++,l++,l>=n&&(l=0,r=0);return m}function a(e,n,t){var i,a,r,o,h,u,c,d=e.length,g=new Array(d),f=[],y=0,w=!1;for(r=0;d>r;r++)g[r]=0;for(r=0;d>r;r++){for(w=!1,o=0;r>o;o++)e[o].almostEqual(e[r])&&(w=!0,g[r]=g[o]);w||(g[r]=y,y++)}for(i=new Array(y),a=new Array(y),r=0;y>r;r++)i[r]=0,a[r]=new s;for(r=0;d>r;r++)c=g[r],i[c]++,a[c].add(e[r]);for(r=0;y>r;r++)h=i[r],h>=n&&(u=1/(h+h),c=new s(u*(2*a[r].x+h),u*(2*a[r].y+h),u*(2*a[r].width+h),u*(2*a[r].height+h)),f.push(c));for(1!=t&&(t=1/t),d=f.length,r=0;d>r;r++)for(o=r+1;d>o;o++)!f[r].isInside&&f[r].inside(f[o])?f[r].isInside=!0:!f[o].isInside&&f[o].inside(f[r])&&(f[o].isInside=!0);for(r=d;--r>=0;)f[r].isInside?f.splice(r,1):(1!=t&&f[r].scale(t),f[r].round().computeArea());return f.sort(l)}function l(e,n){return e.area-n.area}function r(e,n){return e.index-n.index}function o(e){return e[1].length&&(e[0]=e[0].concat(e[1]).sort(r)),e[0]}function h(e){var n,t,i,a,l,r,o,h,u,c,s,d,g,f,y,w,v,x,m,p,S,I,C,q,R,A,H,b,_,D,P,T,j,x,M,L,W,z,E,k,F,O,$,N,U,V,B,G,J,K,Q,X,Y,Z=Z||Math.sqrt,en=[],nn=e.haardata,tn=nn.stages,an=e.scaledSelection,ln=an.width,rn=an.height,on=ln*rn,hn=on-1,un=nn.size1,cn=nn.size2,sn=an.x,dn=an.y,gn=tn.length,fn=e.cannyLow,yn=e.cannyHigh,wn=e.canny,vn=e.integral,xn=e.squares,mn=e.tilted,pn=e.scale,Sn=e.increment,In=e.i||0,Cn=e.doCannyPruning;for(m=0,p=ln-1,S=0,I=on-ln,i=~~(pn*un),n=~~(i*Sn),a=~~(pn*cn),t=~~(a*Sn),u=a*ln,c=t*ln,l=dn*c,y=ln-i,w=rn-a,C=i*a,q=1/C,o=dn,h=l;w>o;o+=t,h+=c)for(r=sn;y>r;r+=n)if(s=r-1+h-ln,d=s+i,g=s+u,f=g+i,s=0>s?0:s>hn?hn:s,d=0>d?0:d>hn?hn:d,g=0>g?0:g>hn?hn:g,f=0>f?0:f>hn?hn:f,!(Cn&&(b=q*(wn[f]-wn[g]-wn[d]+wn[s]),fn>b||b>yn))){for(R=q*(vn[f]-vn[g]-vn[d]+vn[s]),A=q*(xn[f]-xn[g]-xn[d]+xn[s]),H=A-R*R,H=H>1?Z(H):1,_=!0,v=0;gn>v;v++){for(D=tn[v],P=D.thres,T=D.trees,j=T.length,Y=0,x=0;j>x;x++)for(W=T[x].feats,M=0;;){if(z=W[M],E=z.rects,k=E.length,F=z.thres,O=0,z.tilt)for($=0;k>$;$++)N=E[$],U=r+~~(pn*N[0]),V=(o-1+~~(pn*N[1]))*ln,B=r+~~(pn*(N[0]+N[2])),G=(o-1+~~(pn*(N[1]+N[2])))*ln,J=r+~~(pn*(N[0]-N[3])),K=(o-1+~~(pn*(N[1]+N[3])))*ln,Q=r+~~(pn*(N[0]+N[2]-N[3])),X=(o-1+~~(pn*(N[1]+N[2]+N[3])))*ln,U=m>U?m:U>p?p:U,B=m>B?m:B>p?p:B,J=m>J?m:J>p?p:J,Q=m>Q?m:Q>p?p:Q,V=S>V?S:V>I?I:V,G=S>G?S:G>I?I:G,K=S>K?S:K>I?I:K,X=S>X?S:X>I?I:X,O+=N[4]*(mn[Q+X]-mn[J+K]-mn[B+G]+mn[U+V]);else for($=0;k>$;$++)N=E[$],U=r-1+~~(pn*N[0]),B=r-1+~~(pn*(N[0]+N[2])),V=ln*(o-1+~~(pn*N[1])),G=ln*(o-1+~~(pn*(N[1]+N[3]))),U=m>U?m:U>p?p:U,B=m>B?m:B>p?p:B,V=S>V?S:V>I?I:V,G=S>G?S:G>I?I:G,O+=N[4]*(vn[B+G]-vn[U+G]-vn[B+V]+vn[U+V]);if(L=F*H>O*q?0:1){if(z.has_r){Y+=z.r_val;break}M=z.r_node}else{if(z.has_l){Y+=z.l_val;break}M=z.l_node}}if(_=Y>P?!0:!1,!_)break}_&&en.push({index:In,x:r,y:o,width:i,height:a})}return en}function u(e,n){for(var t=0,i=n.length;i>t;t++)n[t]=new s(n[t]);e.objects=a(n,e.min_neighbors,e.Ratio,e.Selection),e.Ready=!0,e.onComplete&&e.onComplete.call(e)}var c,s,d=e.HAAR={VERSION:"0.4.8"},g="prototype",f="undefined"!=typeof Float32Array?Float32Array:Array,y="undefined"!=typeof Uint8Array?Uint8Array:Array,w=Math.abs,v=Math.max,x=Math.min,m=(Math.floor,Math.round),p=(Math.sqrt,Array[g].slice);c=d.Detector=function(e,n){var t=this;t.haardata=e||null,t.Ready=!1,t.doCannyPruning=!1,t.Canvas=null,t.Selection=null,t.scaledSelection=null,t.objects=null,t.TimeInterval=null,t.DetectInterval=30,t.Ratio=.5,t.cannyLow=20,t.cannyHigh=100,t.Parallel=n||null,t.onComplete=null},c[g]={constructor:c,haardata:null,Canvas:null,objects:null,Selection:null,scaledSelection:null,Ratio:.5,origWidth:0,origHeight:0,width:0,height:0,DetectInterval:30,TimeInterval:null,doCannyPruning:!1,cannyLow:20,cannyHigh:100,canny:null,integral:null,squares:null,tilted:null,Parallel:null,Ready:!1,onComplete:null,dispose:function(){var e=this;return e.DetectInterval&&clearTimeout(e.DetectInterval),e.DetectInterval=null,e.TimeInterval=null,e.haardata=null,e.Canvas=null,e.objects=null,e.Selection=null,e.scaledSelection=null,e.Ratio=null,e.origWidth=null,e.origHeight=null,e.width=null,e.height=null,e.doCannyPruning=null,e.cannyLow=null,e.cannyHigh=null,e.canny=null,e.integral=null,e.squares=null,e.tilted=null,e.Parallel=null,e.Ready=null,e.onComplete=null,e},clearCache:function(){var e=this;return e.haardata=null,e.canny=null,e.integral=null,e.squares=null,e.tilted=null,e.Selection=null,e.scaledSelection=null,e},cascade:function(e){return this.haardata=e||null,this},parallel:function(e){return this.Parallel=e||null,this},image:function(e,a,l){var r=this;if(e){var o,h,u,c,s,d,g,f,y,w=e instanceof HTMLVideoElement;r.Canvas||(r.Canvas=l||document.createElement("canvas")),y=r.Canvas,f=r.Ratio=n===a?.5:a,r.Ready=!1,c=r.origWidth=w?e.videoWidth:e.width,s=r.origHeight=w?e.videoHeight:e.height,d=r.width=y.width=m(f*c),g=r.height=y.height=m(f*s),o=y.getContext("2d"),o.drawImage(e,0,0,c,s,0,0,d,g),h=o.getImageData(0,0,d,g),u=t(h.data,h.width,h.height),r.integral=u.integral,r.squares=u.squares,r.tilted=u.tilted,r.canny=i(u.gray,d,g),u.gray=null,u.integral=null,u.squares=null,u.tilted=null,u=null}return r},interval:function(e){return e>0&&(this.DetectInterval=e),this},cannyThreshold:function(e){return e&&n!==e.low&&(this.cannyLow=e.low),e&&n!==e.high&&(this.cannyHigh=e.high),this},select:function(){var e=p.call(arguments),n=e.length;return this.Selection=1==n&&"auto"==e[0]||!n?null:s[g].data.apply(new s,e),this},complete:function(e){return this.onComplete=e||null,this},detect:function(e,t,i,a,l){var c,d,g,f,y=this,w=y.haardata,v=w.size1,m=w.size2,p=y.width,S=y.height,I=y.origWidth,C=y.origHeight,q=y.integral,R=y.squares,A=y.tilted,H=y.canny,b=y.cannyLow,_=y.cannyHigh;y.Selection||(y.Selection=new s(0,0,I,C)),c=y.Selection,c.x="auto"==c.x?0:c.x,c.y="auto"==c.y?0:c.y,c.width="auto"==c.width?I:c.width,c.height="auto"==c.height?C:c.height,d=y.scaledSelection=c.clone().scale(y.Ratio).round(),e=n===e?1:e,t=n===t?1.25:t,i=n===i?.5:i,a=n===a?1:a,l=y.doCannyPruning=n===l?!0:l,g=y.maxScale=x(p/v,S/m),f=y.scale=e,y.min_neighbors=a,y.scale_inc=t,y.increment=i,y.Ready=!1;var D=y.Parallel;if(D&&D.isSupported()){var P,T=[],j=0;for(P=e;g>=P;P*=t)T.push({haardata:w,width:p,height:S,scaledSelection:{x:d.x,y:d.y,width:d.width,height:d.height},integral:q,squares:R,tilted:A,doCannyPruning:l,canny:l?H:null,cannyLow:b,cannyHigh:_,maxScale:g,min_neighbors:a,scale_inc:t,increment:i,scale:P,i:j++});new D(T,{synchronous:!1}).require(r,h,o).map(h).reduce(o).then(function(e){u(y,e)})}else{var M=[],L=function(){y.scale<=y.maxScale?(M=M.concat(h(y)),y.scale*=y.scale_inc,y.TimeInterval=setTimeout(L,y.DetectInterval)):(clearTimeout(y.TimeInterval),u(y,M))};y.TimeInterval=setTimeout(L,y.DetectInterval)}return y},detectSync:function(e,n,t,i,l){var r,o,u=this,c=u.haardata.size1,d=u.haardata.size2;u.Selection||(u.Selection=new s(0,0,u.origWidth,u.origHeight)),u.Selection.x="auto"==u.Selection.x?0:u.Selection.x,u.Selection.y="auto"==u.Selection.y?0:u.Selection.y,u.Selection.width="auto"==u.Selection.width?u.origWidth:u.Selection.width,u.Selection.height="auto"==u.Selection.height?u.origHeight:u.Selection.height,u.scaledSelection=u.Selection.clone().scale(u.Ratio).round(),e="undefined"==typeof e?1:e,n="undefined"==typeof n?1.25:n,t="undefined"==typeof t?.5:t,i="undefined"==typeof i?1:i,u.doCannyPruning="undefined"==typeof l?!0:l,o=u.maxScale=x(u.width/c,u.height/d),r=u.scale=e,u.min_neighbors=i,u.scale_inc=n,u.increment=t,u.Ready=!1;for(var g=[];o>=r;)g=g.concat(h(u)),u.scale=r*=n;for(var f=0,y=g.length;y>f;f++)g[f]=new s(g[f]);return u.objects=a(g,u.min_neighbors,u.Ratio,u.Selection),u.Ready=!0,u.objects}},c[g].selection=c[g].select,s=d.Feature=function(e,n,t,i,a){this.data(e,n,t,i,a)},s[g]={constructor:s,index:0,x:0,y:0,width:0,height:0,area:0,isInside:!1,data:function(e,n,t,i,a){var l=this;return e&&e instanceof s?l.copy(e):e&&e instanceof Object?(l.x=e.x||0,l.y=e.y||0,l.width=e.width||0,l.height=e.height||0,l.index=e.index||0,l.area=e.area||0,l.isInside=e.isInside||!1):(l.x=e||0,l.y=n||0,l.width=t||0,l.height=i||0,l.index=a||0,l.area=0,l.isInside=!1),l},add:function(e){var n=this;return n.x+=e.x,n.y+=e.y,n.width+=e.width,n.height+=e.height,n},scale:function(e){var n=this;return n.x*=e,n.y*=e,n.width*=e,n.height*=e,n},round:function(){var e=this;return e.x=~~(e.x+.5),e.y=~~(e.y+.5),e.width=~~(e.width+.5),e.height=~~(e.height+.5),e},computeArea:function(){var e=this;return e.area=e.width*e.height,e.area},inside:function(e){var n=this;return!!(n.x>=e.x&&n.y>=e.y&&n.x+n.width<=e.x+e.width&&n.y+n.height<=e.y+e.height)},contains:function(e){return e.inside(this)},equal:function(e){var n=this;return!(e.x!==n.x||e.y!==n.y||e.width!==n.width||e.height!==n.height)},almostEqual:function(e){var n=this,t=.2*v(e.width,n.width),i=.2*v(e.height,n.height);return!!(w(n.x-e.x)<=t&&w(n.y-e.y)<=i&&w(n.width-e.width)<=t&&w(n.height-e.height)<=i)},clone:function(){var e=this,n=new s;return n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height,n.index=e.index,n.area=e.area,n.isInside=e.isInside,n},copy:function(e){var n=this;return e&&e instanceof s&&(n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height,n.index=e.index,n.area=e.area,n.isInside=e.isInside),n},toString:function(){return["[ x:",this.x,"y:",this.y,"width:",this.width,"height:",this.height,"]"].join(" ")}}}(e),e.HAAR});